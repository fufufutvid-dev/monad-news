<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MONAD NEWS - Latest Monad Ecosystem Updates</title>
  <meta name="description" content="The most trusted source for real-time Monad ecosystem news, posted and verified on-chain."/>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŸª</text></svg>">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
  
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
          colors: {
            monad: {
              500: '#a855f7',
              600: '#9333ea',
              700: '#7e22ce',
            }
          }
        }
      }
    }
  </script>

  <!-- Ethers.js -->
  <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="text/javascript"></script>

  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #0f0f0f 0%, #1a0033 100%);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(168, 85, 247, 0.25);
    }
    .monad-glow {
      box-shadow: 0 0 30px rgba(168, 85, 247, 0.4);
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 gradient-bg min-h-screen">

  <!-- Header -->
  <header class="border-b border-purple-900/30 backdrop-blur-xl bg-black/50 sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-6 py-5 flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
          MONAD NEWS
        </h1>
        <span class="text-xs bg-purple-900/50 px-3 py-1 rounded-full text-purple-300">On-Chain Verified</span>
      </div>
      
      <w3m-button />
    </div>
  </header>

  <!-- Admin Floating Button (only visible to admin) -->
  <div id="adminPanel" class="fixed bottom-8 right-8 z-50 hidden">
    <button id="openPostModal" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold text-2xl w-16 h-16 rounded-full shadow-2xl monad-glow flex items-center justify-center">
      +
    </button>
  </div>

  <!-- Main Content -->
  <main class="max-w-6xl mx-auto px-6 py-12">
    <div class="text-center mb-16">
      <p class="text-xl text-gray-400 mb-4">Real-time news & updates from the Monad ecosystem</p>
      <p class="text-sm text-gray-500">All articles are posted and timestamped on Monad Testnet â€” immutable & transparent</p>
    </div>

    <div id="newsContainer" class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      <!-- Articles will be injected here -->
      <div class="col-span-full text-center py-20">
        <div class="inline-block animate-pulse">
          <div class="w-16 h-16 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p class="text-gray-400">Loading latest Monad news...</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Post Modal -->
  <div id="postModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center">
    <div class="bg-gray-900 border border-purple-800 rounded-2xl p-8 max-w-2xl mx-auto mt-20 shadow-2xl monad-glow">
      <h2 class="text-2xl font-bold mb-6">Post New Article (Admin Only)</h2>
      <textarea id="articleContent" placeholder="Write your article in markdown or plain text..." class="w-full h-64 bg-gray-800 border border-gray-700 rounded-lg p-4 text-gray-100 placeholder-gray-500 focus:outline-none focus:border-purple-500"></textarea>
      <input type="text" id="sourceLink" placeholder="Source link (optional)" class="w-full mt-4 bg-gray-800 border border-gray-700 rounded-lg px-4 py-3"/>
      
      <div class="flex justify-end space-x-4 mt-6">
        <button id="closeModal" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg">Cancel</button>
        <button id="submitPost" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-lg font-medium">
          Submit On-Chain
        </button>
      </div>
      <p id="txStatus" class="mt-4 text-sm text-gray-400"></p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="mt-24 border-t border-purple-900/30 py-12 text-center">
    <p class="text-gray-500">
      Built for the Monad community â€¢ Credit: 
      <a href="https://x.com/ega_2ez4crypto" target="_blank" class="text-purple-400 hover:underline">@ega_2ez4crypto</a>
    </p>
    <p class="text-xs text-gray-600 mt-2">Monad Testnet â€¢ Chain ID 10143</p>
  </footer>

  <!-- Web3Modal v4 CDN -->
  <script src="https://unpkg.com/@web3modal/ethereum@4.2.2/dist/index.js"></script>
  <script src="https://unpkg.com/@web3modal/wagmi@4.2.2/dist/index.js"></script>

  <script type="module">
    import { createWeb3Modal } from 'https://unpkg.com/@web3modal/wagmi@4.2.2/dist/index.js'
    import { mainnet, configureChains, createClient, WagmiConfig } from 'https://unpkg.com/wagmi@1.4.13/dist/index.js'
    import { publicProvider } from 'https://unpkg.com/wagmi@1.4.13/providers/public.js'
    import { WalletConnectConnector } from 'https://unpkg.com/wagmi@1.4.13/connectors/walletConnect.js'
    import { injected } from 'https://unpkg.com/wagmi@1.4.13/connectors/injected.js'

    const monadTestnet = {
      id: 10143,
      name: 'Monad Testnet',
      network: 'monad-testnet',
      nativeCurrency: { name: 'MON', symbol: 'MON', decimals: 18 },
      rpcUrls: { default: { http: ['https://testnet-rpc.monad.xyz'] }, public: { http: ['https://testnet-rpc.monad.xyz'] } },
      blockExplorers: { default: { name: 'MonadScan', url: 'https://testnet.monadscan.com' } },
      testnet: true,
    }

    const { chains, provider } = configureChains([monadTestnet], [publicProvider()])

    const client = createClient({
      autoConnect: true,
      connectors: [new WalletConnectConnector({ chains, options: { projectId: 'YOUR_PROJECT_ID_IF_YOU_WANT_WALLETCONNECT' } }), injected()],
      provider
    })

    const modal = createWeb3Modal({
      wagmiClient: client,
      projectId: 'OPTIONAL_WALLETCONNECT_PROJECT_ID',
      chains,
      themeMode: 'dark',
      themeVariables: { '--w3m-accent-color': '#a855f7' }
    })

    // Contract ABI (minimal - only what we need)
    const contractABI = [
      "event ArticlePosted(uint256 indexed id, address indexed author, string content, string source, uint256 timestamp)",
      "function getArticleCount() view returns (uint256)",
      "function articles(uint256) view returns (address author, string content, string source, uint256 timestamp)",
      "function postArticle(string content, string source) external"
    ]

    const CONTRACT_ADDRESS = "0xa20e64fDB33D36A82311a3CE3fC01950A440D777"
    const ADMIN_ADDRESS = "0x287aBD1674f25C524503cDA2f1FD42EbECC401eA".toLowerCase()

    let provider, signer, contract, currentAccount = null

    async function initContract() {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum)
        await provider.send("eth_requestAccounts", [])
        signer = provider.getSigner()
        currentAccount = await signer.getAddress()
        contract = new ethers.Contract(CONTRACT_ADDRESS, contractABI, signer)

        // Show admin button only to admin
        if (currentAccount.toLowerCase() === ADMIN_ADDRESS) {
          document.getElementById("adminPanel").classList.remove("hidden")
        }
      }
    }

    // Load articles
    async function loadArticles() {
      if (!contract) await initContract()
      if (!contract) return

      const count = await contract.getArticleCount()
      const container = document.getElementById("newsContainer")
      container.innerHTML = ""

      for (let i = count - 1; i >= 0; i--) {
        const art = await contract.articles(i)
        const date = new Date(art.timestamp * 1000).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })

        const twitterText = encodeURIComponent(`ðŸ”¥ Fresh Monad ecosystem update just dropped!\n\n${art.content.substring(0, 200)}...\n\nRead more on MONAD NEWS ðŸ‘‡`)

        const articleHTML = `
          <article class="bg-gray-800/50 backdrop-blur border border-purple-800/30 rounded-2xl p-8 card-hover monad-glow">
            <div class="flex justify-between items-start mb-4">
              <span class="text-xs bg-purple-900/50 text-purple-300 px-3 py-1 rounded-full">Article #${i + 1}</span>
              <time class="text-sm text-gray-500">${date}</time>
            </div>
            <p class="text-gray-200 leading-relaxed whitespace-pre-wrap">${art.content}</p>
            ${art.source ? `<a href="${art.source}" target="_blank" class="text-purple-400 text-sm mt-4 inline-block hover:underline">Source â†—</a>` : ''}
            
            <div class="mt-6 pt-6 border-t border-gray-700 flex justify-end">
              <a href="https://twitter.com/intent/tweet?text=${twitterText}&url=${encodeURIComponent(window.location.href)}" target="_blank"
                 class="bg-[#1DA1F2] hover:bg-[#0d8aec] text-white px-5 py-2 rounded-lg text-sm font-medium transition flex items-center gap-2">
                <svg class="w-5 h-5" fill-current" viewBox="0 0 24 24"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg>
                Share on Twitter
              </a>
            </div>
          </article>
        `
        container.innerHTML += articleHTML
      }
    }

    // Modal controls
    document.getElementById("openPostModal").onclick = () => {
      document.getElementById("postModal").classList.remove("hidden")
      document.getElementById("postModal").classList.add("flex")
    }

    document.getElementById("closeModal").onclick = () => {
      document.getElementById("postModal").classList.add("hidden")
      document.getElementById("postModal").classList.remove("flex")
    }

    // Submit post
    document.getElementById("submitPost").onclick = async () => {
      const content = document.getElementById("articleContent").value.trim()
      const source = document.getElementById("sourceLink").value.trim()
      if (!content) return alert("Article content is required")

      document.getElementById("submitPost").disabled = true
      document.getElementById("txStatus").textContent = "Sending transaction... (Monad Testnet)"

      try {
        const tx = await contract.postArticle(content, source)
        document.getElementById("txStatus").textContent = "Waiting for confirmation..."
        await tx.wait()
        document.getElementById("txStatus").textContent = "Posted successfully! ðŸŽ‰"
        setTimeout(() => {
          document.getElementById("postModal").classList.add("hidden")
          loadArticles()
        }, 2000)
      } catch (err) {
        console.error(err)
        document.getElementById("txStatus").textContent = "Transaction failed: " + (err.message || err)
      } finally {
        document.getElementById("submitPost").disabled = false
      }
    }

    // Auto-load on connect / page load
    window.addEventListener('load', async () => {
      await initContract()
      await loadArticles()
      setInterval(loadArticles, 30000) // refresh every 30s
    })

    // Reconnect on account change
    if (window.ethereum) {
      window.ethereum.on('accountsChanged', () => location.reload())
      window.ethereum.on('chainChanged', () => location.reload())
    }
  </script>
</body>
</html>
