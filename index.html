<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MONAD NEWS – On-Chain Verified Updates</title>
  <meta name="description" content="Real-time Monad ecosystem news, posted & timestamped directly on Monad Testnet."/>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">

  <!-- Tailwind + DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'glow': 'glow 3s ease-in-out infinite alternate',
            'gradient': 'gradient 15s ease infinite',
          },
          keyframes: {
            float: {
              '0%,100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-20px)' }
            },
            glow: {
              '0%': { boxShadow: '0 0 20px rgba(168,85,247,0.4)' },
              '100%': { boxShadow: '0 0 40px rgba(168,85,247,0.8)' }
            },
            gradient: {
              '0%,100%': { backgroundPosition: '0% 50%' },
              '50%': { backgroundPosition: '100% 50%' }
            }
          }
        }
      }
    }
  </script>

  <!-- Particles.js -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <!-- Ethers.js v6 (latest) -->
  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.min.js";
    window.ethers = ethers;
  </script>

  <style>
    body { overflow-x: hidden; }
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0; left: 0; z-index: -1;
      background: linear-gradient(-45deg, #0f001a, #1a0033, #000000, #110022);
      background-size: 400% 400%;
      animation: gradient 20s ease infinite;
    }
    .glass {
      background: rgba(20, 10, 40, 0.45);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(168, 85, 247, 0.2);
    }
    .card {
      transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .card:hover {
      transform: translateY(-16px) scale(1.02);
    }
  </style>
</head>

<body class="min-h-screen text-white">

  <!-- Animated Background + Particles -->
  <div id="particles-js"></div>

  <!-- Header -->
  <header class="fixed top-0 left-0 right-0 z-50 glass border-b border-purple-800/30">
    <div class="max-w-7xl mx-auto px-6 py-5 flex justify-between items-center">
      <div class="flex items-center gap-4">
        <h1 class="text-4xl font-black font-black bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400 bg-clip-text text-transparent animate-pulse">
          MONAD NEWS
        </h1>
        <span class="text-xs bg-purple-900/60 px-3 py-1 rounded-full border border-purple-500/50">On-Chain Verified</span>
      </div>
      <w3m-button size="md" label="Connect Wallet" />
    </div>
  </header>

  <!-- Hero -->
  <section class="pt-32 pb-20 text-center relative">
    <h2 class="text-5xl md:text-6xl font-black mb-6 bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent animate-glow">
      Latest Monad Ecosystem News
    </h2>
    <p class="text-xl text-purple-200 max-w-2xl mx-auto">
      Every article is posted, timestamped, and verified directly on Monad Testnet — 100% transparent.
    </p>
  </section>

  <!-- News Grid -->
  <main class="max-w-7xl mx-auto px-6 pb-24">
    <div id="newsGrid" class="grid gap-8 md:grid-cols-2 lg:grid-cols-3 auto-rows-fr">
      <div class="col-span-full text-center py-20">
        <div class="inline-block">
          <div class="w-20 h-20 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
          <p class="text-purple-300 text-lg">Loading on-chain articles...</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Admin Floating Button -->
  <div id="adminFab" class="fixed bottom-8 right-8 z-40 hidden">
    <button id="openModalBtn" class="w-16 h-16 rounded-full bg-gradient-to-br from-purple-600 to-pink-600 text-white text-4xl font-black shadow-2xl animate-glow hover:scale-110 transition">
      +
    </button>
  </div>

  <!-- Post Modal -->
  <div id="postModal" class="fixed inset-0 z-50 items-center justify-center hidden">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-md" id="closeModal"></div>
    <div class="relative glass rounded-3xl p-10 max-w-2xl mx-4 shadow-2xl border border-purple-600/40 animate-float">
      <h3 class="text-3xl font-bold mb-6">Post New Article</h3>
      <textarea id="contentInput" class="w-full h-64 bg-black/40 border border-purple-700/50 rounded-2xl p-6 text-white placeholder-purple-300 focus:outline-none focus:border-purple-400 resize-none" placeholder="Write your article (supports markdown/plain text)..."></textarea>
      <input type="url" id="sourceInput" class="w-full mt-5 bg-black/40 border border-purple-700/50 rounded-2xl px-6 py-4 placeholder-purple-300 focus:outline-none focus:border-purple-400" placeholder="Source URL (optional)" />
      
      <div class="flex justify-end gap-4 mt-8">
        <button id="cancelBtn" class="px-8 py-4 bg-gray-800/60 rounded-xl hover:bg-gray-700 transition">Cancel</button>
        <button id="publishBtn" class="px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl font-bold hover:from-purple-700 hover:to-pink-700 transition shadow-lg">
          Publish On-Chain
        </button>
      </div>
      <p id="statusText" class="mt-4 text-center text-purple-300"></p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="glass border-t border-purple-800/30 py-10 text-center">
    <p class="text-purple-300">
      Built for the Monad community • Made with Monad by 
      <a href="https://x.com/ega_2ez4crypto" target="_blank" class="font-bold hover:text-purple-100 transition">@ega_2ez4crypto</a>
    </p>
  </footer>

  <!-- Web3Modal Latest (v5) -->
  <script type="module">
    import { createWeb3Modal } from 'https://unpkg.com/@web3modal/wagmi@5.1.4/dist/index.js'
    import { reconnect, getAccount, watchAccount } from 'https://unpkg.com/@wagmi/core'
    import { createConfig, http } from 'https://unpkg.com/@wagmi/core'
    import { walletConnect from 'https://unpkg.com/@wagmi/connectors@5.1.4/dist/connectors/walletConnect.js'
    import injected from 'https://unpkg.com/@wagmi/connectors@5.1.4/dist/connectors/injected.js'

    const monadTestnet = {
      {
      id: 10143,
      name: 'Monad Testnet',
      nativeCurrency: { name: 'MON', symbol: 'MON', decimals: 18 },
      rpcUrls: { default: { http: ['https://testnet-rpc.monad.xyz'] } },
      blockExplorers: { default: { name: 'MonadScan', url: 'https://testnet.monadscan.com' } },
    }

    const config = createConfig({
      chains: [monadTestnet],
      connectors: [injected(), walletConnect({ projectId: 'c87f1a2e7d8f01f0e8e1e5b7e0e4c5a6' })],
      transports: { [monadTestnet.id]: http() },
    })

    createWeb3Modal({
      wagmiConfig: config,
      projectId: 'c87f1a2e7d8f01f0e8e1e5b7e0e4c5a6',
      themeMode: 'dark',
      themeVariables: { '--w3m-accent': '#a855f7' }
    })

    const CONTRACT = "0xa20e64fDB33D36A82311a3CE3fC01950A440D777"
    const ADMIN = "0x287aBD1674f25C524503cDA2f1FD42EbECC401eA".toLowerCase()

    const ABI = [
      "function getArticleCount() view returns (uint256)",
      "function articles(uint256 idx) view returns (address author, string content, string source, uint256 timestamp)",
      "function postArticle(string content, string source) external",
      "event ArticlePosted(uint256 indexed id, address indexed author, string content, string source, uint256 timestamp)"
    ]

    let provider, signer, contract, address

    async function init() {
      await reconnect(config)
      const account = getAccount(config)
      address = account.address?.toLowerCase()

      if (window.ethereum) {
        provider = new ethers.BrowserProvider(window.ethereum)
        signer = await provider.getSigner()
        contract = new ethers.Contract(CONTRACT, ABI, signer)
      }

      if (address === ADMIN) {
        document.getElementById("adminFab").classList.remove("hidden")
      }

      loadNews()
    }

    async function loadNews() {
      if (!contract) return init()
      try {
        const count = Number(await contract.getArticleCount())
        const grid = document.getElementById("newsGrid")
        grid.innerHTML = ""

        for (let i = count; i > 0; i--) {
          const art = await contract.articles(i - 1)
          const [author, content, source, ts] = await art

          const date = new Date(Number(ts) * 1000).toLocaleDateString('en-US', {
            month: 'long', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit'
          })

          const tweetText = encodeURIComponent(`Monad News Update!\n\n${content.slice(0, 180)}...\n\nRead full article on MONAD NEWS`)
          const url = encodeURIComponent(window.location.href)

          const card = document.createElement('article')
          card.className = "glass rounded-3xl p-8 card animate-float border border-purple-700/30"
          card.innerHTML = `
            <div class="flex justify-between items-start mb-5">
              <span class="text-xs bg-purple-900/70 px-4 py-2 rounded-full">Article #${i}</span>
              <time class="text-purple-300 text-sm">${date}</time>
            </div>
            <p class="text-gray-100 leading-relaxed mb-6 whitespace-pre-wrap">${content}</p>
            ${source ? `<a href="${source}" target="_blank class="text-purple-400 hover:underline text-sm">Source Link</a>` : ''}
            <div class="mt-8 pt-6 border-t border-purple-800/40 flex justify-end">
              <a href="https://twitter.com/intent/tweet?text=${tweetText}&url=${url}" target="_blank"
                 class="bg-[#1DA1F2] hover:bg-[#0d8aec] px-6 py-3 rounded-xl font-bold flex items-center gap-3 transition">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg>
                Share on X
              </a>
            </div>
          `
          grid.appendChild(card)
        }
      } catch (e) {
        console.error(e)
      }
    }

    // Modal controls
    document.getElementById("openModalBtn")?.addEventListener("click", () => {
      document.getElementById("postModal").classList.remove("hidden")
      document.getElementById("postModal").classList.add("flex")
    })

    document.getElementById("closeModal")?.addEventListener("click", () => {
      document.getElementById("postModal").classList.add("hidden")
      document.getElementById("postModal").classList.remove("flex")
    })
    document.getElementById("cancelBtn")?.addEventListener("click", () => document.getElementById("closeModal").click())

    document.getElementById("publishBtn")?.addEventListener("click", async () => {
      const content = document.getElementById("contentInput").value.trim()
      const source = document.getElementById("sourceInput").value.trim()
      if (!content) return alert("Content required")

      document.getElementById("publishBtn").disabled = true
      document.getElementById("statusText").textContent = "Sending transaction to Monad Testnet..."

      try {
        const tx = await contract.postArticle(content, source || "")
        document.getElementById("statusText").textContent = "Waiting for confirmation..."
        await tx.wait()
        document.getElementById("statusText").textContent = "Published successfully!"
        setTimeout(() => {
          document.getElementById("closeModal").click()
          loadNews()
        }, 2000)
      } catch (err) {
        document.getElementById("statusText").textContent = "Failed: " + (err.message || err)
      } finally {
        document.getElementById("publishBtn").disabled = false
      }
    })

    // Particles
    particlesJS("particles-js", {
      "particles": {
        "number": { "value": 80 },
        "color": { "value": "#a855f7" },
        "shape": { "type": "circle" },
        "opacity": { "value": 0.5, "random": true },
        "size": { "value": 3, "random": true },
        "line_linked": { "enable": true, "distance": 150, "color": "#a855f7", "opacity": 0.2, "width": 1 },
        "move": { "enable": true, "speed": 2, "direction": "none", "random": false, "straight": false }
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": { "onhover": { "enable": true, "mode": "repulse" } },
      },
      "retina_detect": true
    });

    // Auto refresh every 30s
    setInterval(loadNews, 30000)
    watchAccount(config, { onChange: () => location.reload() })

    // Init on load
    window.addEventListener('load', init)
  </script>
</body>
</html>
